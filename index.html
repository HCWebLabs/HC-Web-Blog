<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HC Web Labs — Universal Blog / Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Glassmorphic blog dashboard for HC Web Labs: case studies, opinions, tech + web design. Single-select chips, smooth pagination, and modal preview." />
  <meta name="color-scheme" content="dark" />
  <base href="./">

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Saira:wght@400;500&family=Sarpanch:wght@700;800&family=Mulish:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* =========================
       BULLET-PROOF HALO BACKDROP
       ========================= */
    html, body { height:100%; margin:0; background:transparent; isolation:isolate; }
    body { color: var(--ink); } /* enforce bright text globally */
    body > * { position:relative; z-index:0; }
    header, .site-header, [data-sticky] { position:relative; z-index:3; }

    :root{
      /* Bright, always-on-glass text */
      --ink: #f6f7fb;
      --muted: #c6ccda;
      --line: rgba(255,255,255,.16);

      --radius: 16px;
      --gap: .75rem;
      --shadow: 0 14px 48px rgba(0,0,0,.50);

      /* Halo grid backdrop */
      --bg-ink-start:#161821; --bg-ink-mid:#12141b; --bg-ink-end:#0e1015;
      --halo-c1: color(display-p3 0.30 0.98 0.97 / .28);
      --halo-c2: color(display-p3 0.74 0.42 1 / .24);
      --grid-size: 60px; --grid-alpha: .25;

      /* Glass tokens */
      --stroke: #ffffff26;
      --glass-a: .22;  /* aqua tint */
      --glass-b: .18;  /* vio tint */
      --blur: 20px;

      /* Layout */
      --pad: clamp(18px, 2.6vw, 32px);
      --maxw: 1100px;
      --chip: 999px;
    }

    html::before, html::after { content:""; position:fixed; inset:0; pointer-events:none; }
    html::before{
      z-index:-2;
      background:
        radial-gradient(90% 70% at 48% 30%, var(--halo-c1), var(--halo-c2) 45%, transparent 74%),
        linear-gradient(180deg, var(--bg-ink-start) 0%, var(--bg-ink-mid) 55%, var(--bg-ink-end) 100%);
    }
    html::after{
      z-index:-1; --sz:var(--grid-size); --a:var(--grid-alpha);
      background:
        repeating-linear-gradient(to right, rgba(255,255,255,var(--a)) 0 1px, transparent 1px var(--sz)),
        repeating-linear-gradient(to bottom, rgba(255,255,255,var(--a)) 0 1px, transparent 1px var(--sz));
    }
    @supports (mask: radial-gradient(#000,transparent)) or (-webkit-mask: radial-gradient(#000,transparent)){
      html::after{ -webkit-mask: radial-gradient(60% 60% at 50% 20%, #000 0%, transparent 80%); mask: radial-gradient(60% 60% at 50% 20%, #000 0%, transparent 80%); }
    }
    @media (max-width:768px){ :root{ --grid-size: clamp(44px, 8vw, 56px); --grid-alpha:.16; } }
    @media (prefers-contrast: more){ :root{ --grid-alpha: .30; } }
    @media (prefers-contrast: less){ :root{ --grid-alpha: .18; } }
    @media (forced-colors: active){ html::before{ background:Canvas !important } html::after{ display:none !important } }
    @media print{ html::before, html::after{ display:none !important } }

    /* =========================
       COMPONENT SCOPE
       ========================= */
    #hc-blog[data-scope="dashboard"], #hc-blog * { box-sizing: border-box; }
    #hc-blog{
      color: var(--ink); /* enforce */
      background: transparent;
      font-family: Mulish, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
      container-type: inline-size;
      padding-block: clamp(24px, 5vw, 60px);
    }

    /* True glass pane header */
    #hc-blog .wrap{
      margin-inline: auto; padding: var(--pad); max-width: var(--maxw);
      border:1px solid var(--stroke); border-radius: var(--radius); box-shadow: var(--shadow);
      position:relative; isolation:isolate; overflow:hidden; color: var(--ink);
      background:
        linear-gradient(135deg, color(display-p3 0 0.91 1 / var(--glass-a)), color(display-p3 0.66 0.43 1 / var(--glass-b))),
        linear-gradient(180deg, rgba(12,14,22,.40), rgba(12,14,22,.30));
      -webkit-backdrop-filter: blur(var(--blur)) saturate(118%) contrast(1.03);
              backdrop-filter: blur(var(--blur)) saturate(118%) contrast(1.03);
    }
    #hc-blog .wrap::before{ content:""; position:absolute; inset:0; pointer-events:none; border-radius:inherit; box-shadow: inset 0 1px 0 rgba(255,255,255,.14); }

    .eyebrow{
      display:inline-flex; align-items:center; gap:.5em; font-weight:800; font-size:.78rem; letter-spacing:.12em; text-transform:uppercase;
      background:linear-gradient(90deg, color(display-p3 0 1 .75), color(display-p3 .75 .45 1), color(display-p3 .9 .5 .95));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    #hc-blog-title{
      font-family:Sarpanch, Mulish, system-ui, sans-serif; font-weight:800; line-height:1.06; letter-spacing:.3px;
      font-size: clamp(1.9rem, 3.6vw, 2.7rem); margin-block: .25em .5em;
      background:linear-gradient(90deg, color(display-p3 0 1 .75), color(display-p3 .75 .45 1));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 2px 10px rgba(168,108,255,.18));
    }

    /* Filters — SINGLE SELECT */
    .filters{ display:flex; flex-wrap:wrap; gap:.5rem; margin-block: .2rem 0; }
    .chip{
      display:inline-flex; align-items:center; gap:.45rem; font-size:.95rem; font-weight:700; line-height:1;
      padding:.56rem .78rem; border:1px solid var(--stroke); border-radius: var(--chip);
      color: var(--ink); text-decoration:none;
      background:
        linear-gradient(135deg, color(display-p3 0 0.91 1 / .14), color(display-p3 0.66 0.43 1 / .12)),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      -webkit-backdrop-filter: blur(8px) saturate(110%); backdrop-filter: blur(8px) saturate(110%);
      cursor:pointer; user-select:none; min-height:44px;
    }
    .chip[data-active="true"]{ outline:2px solid color(display-p3 .75 .45 1 / .6); outline-offset:2px; }
    .chip:focus-visible{ outline:3px solid color(display-p3 .75 .45 1 / .7); outline-offset:2px; }

    /* Grid + Cards */
    .grid{
      display:grid; gap: clamp(14px, 2.2vw, 22px);
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      margin: clamp(16px, 2.6vw, 24px) auto 0;
      max-width: var(--maxw); padding-inline: var(--pad);
      content-visibility:auto; contain-intrinsic-size: 800px 1200px;
      color: var(--ink);
    }
    .card{
      position:relative; isolation:isolate; border-radius: 16px; overflow:hidden; border:1px solid var(--line);
      background:
        linear-gradient(135deg, color(display-p3 0 0.91 1 / .12), color(display-p3 0.66 0.43 1 / .10)),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      -webkit-backdrop-filter: blur(10px) saturate(120%); backdrop-filter: blur(10px) saturate(120%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.10), 0 10px 28px rgba(0,0,0,.42);
      display:grid; grid-template-rows:auto 1fr auto;
      color: var(--ink);
    }
    .card * { color: inherit; } /* force inheritance inside cards */
    .card:hover{ border-color: rgba(255,255,255,.24) }
    .card::after{
      content:""; position:absolute; inset:-1px; border-radius:inherit; pointer-events:none; opacity:0;
      background:linear-gradient(135deg, color(display-p3 0 1 .75), color(display-p3 .75 .45 1)); mix-blend-mode:screen; transition:opacity .18s ease;
    }
    .card:hover::after{ opacity:.18; }

    .thumb{ aspect-ratio:16/9; overflow:hidden; }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; filter:saturate(112%); }

    .body{ padding:14px 14px 10px; }
    .card h3{
      font-family: Saira, system-ui, sans-serif;
      font-weight: 500; font-size:1.12rem; margin:0 0 .35rem; line-height:1.2;
      text-wrap:balance;
    }
    .meta{ color: var(--muted); font-size:.92rem; display:flex; gap:.8rem; align-items:center; }
    .meta .dot{ inline-size:4px; block-size:4px; border-radius:50%; background: var(--line); display:inline-block; }
    .tags{ display:flex; flex-wrap:wrap; gap:.4rem; padding:0 14px 14px; }
    .tag{ font-size:.8rem; padding:.28rem .5rem; border:1px solid var(--line); border-radius:999px; background: rgba(255,255,255,.06); color: var(--ink); }

    .card a.stretch{ position:absolute; inset:0; z-index:1; border-radius:inherit; }

    /* Skeletons */
    .skeleton .thumb{ background:linear-gradient(90deg, #ffffff08, #ffffff15 40%, #ffffff08 80%); background-size:200% 100%; animation:shimmer 1.2s linear infinite; }
    .skeleton .body, .skeleton .tags{ opacity:.55 }
    @keyframes shimmer{ to{ background-position:-200% 0; } }

    /* Pager */
    .pager{ display:flex; justify-content:center; gap:.6rem; margin: clamp(18px, 3vw, 28px) 0; padding-inline: var(--pad); }
    .pager button{
      min-inline-size: 44px; min-block-size: 44px; text-align:center; border:1px solid var(--stroke); border-radius:12px; padding:.5rem .8rem;
      color: var(--ink);
      background:
        linear-gradient(135deg, color(display-p3 0 0.91 1 / .14), color(display-p3 0.66 0.43 1 / .12)),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      -webkit-backdrop-filter: blur(8px) saturate(110%); backdrop-filter: blur(8px) saturate(110%);
      cursor:pointer;
    }
    .pager button[disabled]{ opacity:.45; cursor:not-allowed; }
    .pager .num[aria-current="true"]{ outline:2px solid color(display-p3 .75 .45 1 / .6); outline-offset:2px; }

    /* Page turn animation */
    @media (prefers-reduced-motion: no-preference){
      .grid.turning-out .card{ animation: turnOut .22s ease forwards; }
      .grid.turning-in  .card{ animation: turnIn  .22s ease forwards; }
      @keyframes turnOut{ from{opacity:1; transform:translateY(0)} to{opacity:0; transform:translateY(6px)} }
      @keyframes turnIn { from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)} }
    }

    /* Modal reader */
    dialog#hc-reader{
      inline-size:min(920px, 92vw); max-block-size:88vh; border:none; padding:0; border-radius:20px; overflow:hidden; color:var(--ink);
      background:
        linear-gradient(135deg, color(display-p3 0 0.91 1 / .20), color(display-p3 0.66 0.43 1 / .18)),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      -webkit-backdrop-filter: blur(18px) saturate(120%); backdrop-filter: blur(18px) saturate(120%);
      box-shadow: 0 18px 64px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.14);
    }
    dialog#hc-reader::backdrop{ background: rgba(0,0,0,.55); }
    .reader-head{ display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:12px 14px; border-block-end:1px dashed var(--line); color: var(--ink); }
    .reader-title{ font-family: Saira, system-ui, sans-serif; font-weight:500; font-size:1.12rem; margin:0; text-wrap:balance; color: var(--ink); }
    .reader-close{
      border:1px solid var(--stroke); border-radius:12px; padding:.55rem .8rem; color:var(--ink); cursor:pointer;
      background:
        linear-gradient(135deg, color(display-p3 0 0.91 1 / .14), color(display-p3 0.66 0.43 1 / .12)),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      min-block-size:44px;
    }
    .reader-body{ padding:0; background:transparent; color: var(--ink); }
    .reader-body iframe{ inline-size:100%; block-size:70vh; border:none; display:block; background:transparent; }
    .reader-foot{ display:flex; justify-content:flex-end; gap:.6rem; padding:10px 14px; border-block-start:1px dashed var(--line); color: var(--ink); }
    .open-native{
      text-decoration:none; color:var(--ink); border:1px solid var(--stroke); border-radius:12px; padding:.55rem .8rem; display:inline-flex; align-items:center; gap:.5rem;
      background:
        linear-gradient(135deg, color(display-p3 0 0.91 1 / .14), color(display-p3 0.66 0.43 1 / .12)),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      min-block-size:44px;
    }

    /* Container queries & breakpoints */
    @container (max-width: 600px){ .card h3{ font-size: 1.05rem; } }
    @media (min-width:390px){ .grid{ grid-template-columns: repeat(auto-fit,minmax(280px,1fr)); } }
    @media (min-width:500px){ .grid{ grid-template-columns: repeat(auto-fit,minmax(300px,1fr)); } }
    @media (min-width:768px){ .grid{ gap: clamp(18px, 2.4vw, 26px); } }
    @media (min-width:1024px){ .card h3{ font-size:1.18rem } }
    @media (min-width:1280px){ #hc-blog .wrap{ max-width: var(--maxw); } }
    @media (min-width:1440px){ .grid{ max-width: calc(var(--maxw) + 120px) } }

    /* Focus & forced-colors */
    :focus-visible{ outline: 3px solid color(display-p3 .75 .45 1 / .7); outline-offset: 2px; }
    @media (forced-colors: active){
      .chip, .pager button, .reader-close, .open-native { forced-color-adjust: auto; border-color: CanvasText; }
      .card, .wrap, dialog#hc-reader{ background: Canvas; }
    }

    /* JS-off note */
    noscript .nojs-note{
      margin: 1rem auto 0; max-width: var(--maxw); padding: 1rem var(--pad);
      color: var(--ink); border: 1px solid var(--line); border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }
  </style>
</head>

<body>
  <section id="hc-blog" data-scope="dashboard" aria-labelledby="hc-blog-title">
    <header class="wrap">
      <div class="eyebrow" aria-label="Dashboard"><i class="fa-solid fa-bolt" aria-hidden="true"></i><span>HC WEB LABS • BLOG</span></div>
      <h1 id="hc-blog-title">Studio Updates, Case Studies & Opinions</h1>

      <nav class="filters" aria-label="Content filters">
        <button class="chip" type="button" data-filter="all" data-active="true" aria-pressed="true">All</button>
        <button class="chip" type="button" data-filter="case-studies" aria-pressed="false">Case Studies</button>
        <button class="chip" type="button" data-filter="opinion" aria-pressed="false">Opinion</button>
        <button class="chip" type="button" data-filter="web-design" aria-pressed="false">Web Design</button>
        <button class="chip" type="button" data-filter="front-end" aria-pressed="false">Front-End</button>
        <button class="chip" type="button" data-filter="accessibility" aria-pressed="false">Accessibility</button>
        <button class="chip" type="button" data-filter="tech" aria-pressed="false">Tech</button>
      </nav>
    </header>

    <main class="grid" id="hc-grid" aria-live="polite" aria-busy="true"></main>
    <nav class="pager" id="hc-pager" aria-label="Pagination"></nav>

    <dialog id="hc-reader" aria-label="Post preview">
      <div class="reader-head">
        <h3 class="reader-title" id="hc-reader-title">Loading…</h3>
        <button class="reader-close" type="button" aria-label="Close reader">
          <i class="fa-solid fa-xmark" aria-hidden="true"></i>
        </button>
      </div>
      <div class="reader-body">
        <iframe id="hc-reader-frame" referrerpolicy="no-referrer" title="Post preview"></iframe>
      </div>
      <div class="reader-foot">
        <a class="open-native" id="hc-reader-open" href="#" target="_blank" rel="noopener">
          <i class="fa-solid fa-up-right-from-square" aria-hidden="true"></i> Open full page
        </a>
      </div>
    </dialog>

    <noscript>
      <div class="nojs-note">
        <p><strong>JavaScript is off.</strong> Turn it on to see the live dashboard. You can still open posts directly under the <code>/posts/</code> folder if you know the URL.</p>
      </div>
    </noscript>
  </section>

  <script type="module">
    // Utilities
    const $ = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const supportsVT = 'startViewTransition' in document;
    const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;

    const grid  = $('#hc-grid');
    const pager = $('#hc-pager');
    const chipsBar = $('#hc-blog .filters');

    const withBase = (u) => typeof u === 'string' ? u.replace(/^\/+/, '') : u;
    const fmtDate = (iso) => { try{ return new Date(iso).toLocaleDateString(undefined, { month:'short', day:'2-digit', year:'numeric' }); }catch{ return iso; } };

    // Build card
    function makeCard(p){
      const art = document.createElement('article');
      art.className = 'card';
      art.setAttribute('data-cats', (p.cats||[]).join(','));
      art.setAttribute('data-date', p.date);
      art.innerHTML = `
        <a class="stretch" href="${withBase(p.url)}" data-url="${withBase(p.url)}" data-modal></a>
        <div class="thumb">
          <img src="${p.image}" alt="${p.alt||''}" loading="lazy" decoding="async" width="1200" height="675">
        </div>
        <div class="body">
          <h3>${p.title}</h3>
          <div class="meta"><span>${fmtDate(p.date)}</span><span class="dot" aria-hidden="true"></span><span>${p.author||'HC Web Labs'}</span></div>
        </div>
        <div class="tags">${(p.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('')}</div>
      `;
      return art;
    }

    // Skeletons
    function showSkeleton(count=6){
      grid.innerHTML = '';
      const frag = document.createDocumentFragment();
      for(let i=0;i<count;i++){
        const sk = document.createElement('article');
        sk.className = 'card skeleton';
        sk.innerHTML = `
          <div class="thumb"></div>
          <div class="body">
            <h3 style="height:1.2rem;background:#ffffff10;border-radius:6px;width:70%"></h3>
            <div class="meta">
              <span style="height:.9rem;background:#ffffff10;border-radius:4px;display:inline-block;width:90px"></span>
              <span class="dot"></span>
              <span style="height:.9rem;background:#ffffff10;border-radius:4px;display:inline-block;width:120px"></span>
            </div>
          </div>
          <div class="tags">
            <span class="tag" style="opacity:.4">Loading</span>
          </div>`;
        frag.appendChild(sk);
      }
      grid.appendChild(frag);
    }

    // Load posts.json
    let cards = [];
    async function loadPosts(){
      showSkeleton(6);
      try{
        const res = await fetch('data/posts.json', {cache:'no-store'});
        if(!res.ok) throw new Error('Failed to fetch posts.json');
        const data = await res.json();
        cards = data.map(p => ({
          meta: p,
          el: makeCard(p),
          date: new Date(p.date),
          cats: (p.cats||[])
        })).sort((a,b)=> b.date - a.date);
      }catch(err){
        console.error('[HC BLOG] ', err);
        grid.innerHTML = `<div class="nojs-note" role="status" style="margin-top:1rem">
          <p>Couldn’t load posts. Check <code>data/posts.json</code> path on GitHub Pages.</p>
        </div>`;
        pager.innerHTML = '';
      }
    }

    // State
    const qs = new URLSearchParams(location.search);
    const state = {
      pageSize: 6,
      page: Math.max(1, parseInt(qs.get('page') || '1', 10)),
      filter: (qs.get('cat') || 'all')
    };

    // Chips
    function syncChips(){
      $$('.chip', chipsBar).forEach(chip=>{
        const on = chip.dataset.filter === state.filter;
        chip.dataset.active = on ? 'true' : 'false';
        chip.setAttribute('aria-pressed', String(on));
      });
    }
    chipsBar.addEventListener('click', (e)=>{
      const chip = e.target.closest('.chip'); if(!chip) return;
      const key = chip.dataset.filter;
      if(key && key !== state.filter){
        state.filter = key;
        state.page = 1;
        syncChips();
        render({animate:true, announce:true});
      }
    });

    // Filter + Pagination
    function getFiltered(){
      if(state.filter === 'all') return cards;
      return cards.filter(p => p.cats.includes(state.filter));
    }

    function buildPager(totalPages){
      const p = state.page;
      const mkNum = (n, cur=false) => `<button class="num" data-goto="${n}" ${cur?'aria-current="true"':''}>${n}</button>`;
      const ell = () => `<button class="ellipsis" disabled aria-hidden="true">…</button>`;
      let nums = '';
      if(totalPages <= 7){ for(let i=1;i<=totalPages;i++) nums += mkNum(i, i===p); }
      else if(p <= 4){ for(let i=1;i<=5;i++) nums += mkNum(i, i===p); nums += ell() + mkNum(totalPages); }
      else if(p >= totalPages - 3){ nums += mkNum(1) + ell(); for(let i=totalPages-4;i<=totalPages;i++) nums += mkNum(i, i===p); }
      else { nums += mkNum(1) + ell() + mkNum(p-1) + mkNum(p,true) + mkNum(p+1) + ell() + mkNum(totalPages); }

      pager.innerHTML =
        `<button class="prev" data-goto="${p-1}" ${p===1?'disabled':''} aria-label="Previous page"><i class="fa-solid fa-angle-left" aria-hidden="true"></i></button>` +
        nums +
        `<button class="next" data-goto="${p+1}" ${p===totalPages?'disabled':''} aria-label="Next page"><i class="fa-solid fa-angle-right" aria-hidden="true"></i></button>`;

      $$('.pager [data-goto]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const next = parseInt(btn.getAttribute('data-goto'), 10);
          if(Number.isFinite(next)){
            state.page = Math.max(1, Math.min(totalPages, next));
            render({animate:true, announce:true});
            $('#hc-blog .wrap')?.scrollIntoView({ behavior:'smooth', block:'start' });
          }
        });
      });
    }

    function swapGridContent(nodes, totalPages, announce){
      while(grid.firstChild) grid.removeChild(grid.firstChild);
      nodes.forEach(n => grid.appendChild(n));
      buildPager(totalPages);
      if(announce){
        grid.setAttribute('aria-live','polite');
        grid.setAttribute('aria-busy','false');
      }
    }

    function render({animate=false, announce=false} = {}){
      const filtered = getFiltered();
      const totalPages = Math.max(1, Math.ceil(filtered.length / state.pageSize));
      state.page = Math.min(Math.max(1, state.page), totalPages);

      // URL sync
      const params = new URLSearchParams(location.search);
      state.filter === 'all' ? params.delete('cat') : params.set('cat', state.filter);
      state.page > 1 ? params.set('page', state.page) : params.delete('page');
      history.replaceState({}, '', location.pathname + (params.toString()?('?'+params.toString()):''));

      const start = (state.page - 1) * state.pageSize;
      const end   = Math.min(start + state.pageSize, filtered.length);
      const nodes = filtered.slice(start, end).map(p => p.el);

      const doSwap = () => swapGridContent(nodes, totalPages, announce);

      if(announce){ grid.setAttribute('aria-busy','true'); }

      if(animate && !prefersReduced){
        if(supportsVT){ document.startViewTransition(doSwap); }
        else{
          grid.classList.add('turning-out');
          setTimeout(()=>{
            doSwap();
            grid.classList.remove('turning-out');
            grid.classList.add('turning-in');
            setTimeout(()=>grid.classList.remove('turning-in'), 260);
          }, 180);
        }
      }else{
        doSwap();
      }
    }

    // Modal Reader
    const dlg = $('#hc-reader');
    const iframe = $('#hc-reader-frame');
    const titleEl = $('#hc-reader-title');
    const openBtn = $('#hc-reader-open');
    const closeBtn = $('.reader-close', dlg);
    const dialogSupported = 'HTMLDialogElement' in window;

    grid.addEventListener('click', (e)=>{
      const a = e.target.closest('a.stretch'); if(!a) return;
      const url = a.getAttribute('data-url') || a.getAttribute('href');
      if(!a.hasAttribute('data-modal') || !dialogSupported) return;
      e.preventDefault();

      const t = a.parentElement?.querySelector('h3')?.textContent?.trim() || 'Post';
      titleEl.textContent = t;
      openBtn.href = url;
      iframe.setAttribute('title', t);
      iframe.src = url;
      if(!dlg.open) dlg.showModal();
    });

    closeBtn?.addEventListener('click', ()=> dlg.close());
    dlg?.addEventListener('cancel', (ev)=>{ ev.preventDefault(); dlg.close(); });

    // Optional scroll-driven micro-reveal
    if (CSS.supports('animation-timeline: scroll()')) {
      const style = document.createElement('style');
      style.textContent = `
        @scroll-timeline reveal-timeline { source: auto; orientation: block; }
        .card{ animation: reveal 1s both; animation-timeline: reveal-timeline; animation-range: entry 0% cover 30%; }
        @keyframes reveal{ from{ opacity:0; transform: translateY(12px); } to{ opacity:1; transform:none; } }
        @media (prefers-reduced-motion: reduce){ .card{ animation:none !important } }
      `;
      document.head.appendChild(style);
    }

    // Boot
    await loadPosts();
    syncChips();
    render();
  </script>
</body>
</html>
